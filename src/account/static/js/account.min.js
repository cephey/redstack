angular.module("UserApp",["Cookies"]),angular.module("UserApp").config(["$interpolateProvider","$httpProvider",function(a,b){a.startSymbol("[%"),a.endSymbol("%]"),b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("UserApp").controller("UserPopupCtrl",["$scope","UserPopup",function(a,b){a.popup=b}]),angular.module("UserApp").controller("LoginFormCtrl",["$scope","LoginForm",function(a,b){a.form=b}]),angular.module("UserApp").controller("RegisterFormCtrl",["$scope","RegisterForm",function(a,b){a.form=b}]),angular.module("UserApp").controller("ForgotFormCtrl",["$scope","ForgotForm",function(a,b){a.form=b}]),angular.module("UserApp").controller("SignCtrl",["$scope","UserHandler","UserPopup",function(a,b,c){a.login=c.showLogin,a.logout=b.logout}]),angular.module("UserApp").factory("UserPopup",function(){return function(){var a={LOGIN:0,REGISTER:1,FORGOT:2},b=a.LOGIN,c=$("#user-popup-modal"),d=function(a){return a===b},e=function(a){g()||c.modal(),b=a},f=function(){c.modal("hide")},g=function(){return c.is(":visible")};return{states:a,is_active:d,showLogin:function(){e(a.LOGIN)},showRegister:function(){e(a.REGISTER)},showForgot:function(){e(a.FORGOT)},hide:f}}()}),angular.module("UserApp").factory("LoginForm",["$http","Cookies","UserHandler",function(a,b,c){return function(){var d={username:"",password:""},e={username:!1,password:!1,__all__:!1},f=function(){for(var a in e)e[a]=!1},g="btn-submit-login",h=function(a){if(a)for(var b in a)e[b]=a[b];else e.__all__=["Ошибка сервера"]},i=function(e){f();var i=Ladda.create(document.querySelector("."+g));i.start(),a.defaults.headers.post["X-CSRFToken"]=b.getCookie("csrftoken"),a.post(e,$.param(d)).success(function(a){a.success===!0?c.callback(a.redirect):h(a.errors)}).error(function(){h()}).finally(function(){i.stop()})};return{fields:d,errors:e,show_errors:h,clear_errors:f,submit:i,btnSubmitSelector:g}}()}]),angular.module("UserApp").factory("RegisterForm",["$http","Cookies","UserHandler",function(a,b,c){return function(){var d={email:""},e={email:!1,__all__:!1},f=function(){for(var a in e)e[a]=!1},g="btn-submit-register",h=function(a){if(a)for(var b in a)e[b]=a[b];else e.__all__=["Ошибка сервера"]},i=function(e){f();var i=Ladda.create(document.querySelector("."+g));i.start(),a.defaults.headers.post["X-CSRFToken"]=b.getCookie("csrftoken"),a.post(e,$.param(d)).success(function(a){a.success===!0?c.callback(a.redirect):h(a.errors)}).error(function(){h()}).finally(function(){i.stop()})};return{fields:d,errors:e,show_errors:h,clear_errors:f,submit:i,btnSubmitSelector:g}}()}]),angular.module("UserApp").factory("ForgotForm",["$http","$q","Cookies",function(a,b,c){return function(){var b={email:""},d={email:!1,__all__:!1},e=function(){for(var a in d)d[a]=!1},f="btn-submit-forgot",g=function(a){if(a)for(var b in a)d[b]=a[b];else d.__all__=["Ошибка сервера"]},h=function(d){e();var h=Ladda.create(document.querySelector("."+f));h.start(),a.defaults.headers.post["X-CSRFToken"]=c.getCookie("csrftoken"),a.post(d,$.param(b)).success(function(a){a.success===!0?console.log(a):g(a.errors)}).error(function(){g()}).finally(function(){h.stop()})};return{fields:b,errors:d,show_errors:g,clear_errors:e,submit:h,btnSubmitSelector:f}}()}]),angular.module("UserApp").factory("UserHandler",["$http","$q","UserPopup",function(a,b,c){var d,e=function(){var c=b.defer();return a.get(window.check_user_auth_url).success(function(a){c.resolve(a.auth===!0?!0:!1)}).error(function(){c.reject("--error--")}),c.promise},f=function(a){"function"==typeof d?(c.hide(),d(),d=void 0):a?location.replace(a):location.reload()},g=function(a){a&&(d=a),c.showLogin()},h=function(a){location.replace(a)};return{login:g,logout:h,is_auth:e,callback:f}}]);