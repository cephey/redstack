angular.module("UserApp",["ngSanitize"]),angular.module("UserApp").config(["$interpolateProvider","$httpProvider",function(a,b){a.startSymbol("[%"),a.endSymbol("%]"),b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("UserApp").controller("UserPopupCtrl",["$scope","UserPopup",function(a,b){a.popup=b}]),angular.module("UserApp").controller("LoginFormCtrl",["$scope","$http","UserHandler",function(a,b,c){a.form=new AngForm(["email","password"]),a.form.submit=function(a){var d=this.errors,e=this.loader;d.clear(),e.show(),b.defaults.headers.post["X-CSRFToken"]=Cookie.getCookie("csrftoken"),b.post(a,$.param(this.fields)).success(function(a){a.success===!0?c.callback(a):d.show(a)}).error(function(){d.show()}).finally(function(){e.hide()})}}]),angular.module("UserApp").controller("RegisterFormCtrl",["$scope","$http","UserHandler",function(a,b,c){a.form=new AngForm(["email"]),a.form.submit=function(a){var d=this.errors,e=this.loader;d.clear(),e.show(),b.defaults.headers.post["X-CSRFToken"]=Cookie.getCookie("csrftoken"),b.post(a,$.param(this.fields)).success(function(a){a.success===!0?c.callback(a):d.show(a)}).error(function(){d.show()}).finally(function(){e.hide()})}}]),angular.module("UserApp").controller("ForgotFormCtrl",["$scope","$http",function(a,b){a.form=new AngForm(["email"]),a.form.submit=function(a){var c=this.errors,d=this.success,e=this.loader;c.clear(),d.clear(),e.show(),b.defaults.headers.post["X-CSRFToken"]=Cookie.getCookie("csrftoken"),b.post(a,$.param(this.fields)).success(function(a){a.success===!0?d.set(a):c.show(a)}).error(function(){c.show()}).finally(function(){e.hide()})}}]),angular.module("UserApp").controller("PasswordResetFormCtrl",["$scope","$http",function(a,b){a.form=new AngForm(["new_password"]),a.form.submit=function(a){var c=this.errors,d=this.loader;c.clear(),d.show(),b.defaults.headers.post["X-CSRFToken"]=Cookie.getCookie("csrftoken"),b.post(a,$.param(this.fields)).success(function(a){a.success===!0?location.replace(a.redirect):c.show(a)}).error(function(){c.show()}).finally(function(){d.hide()})}}]),angular.module("UserApp").controller("PasswordChangeFormCtrl",["$scope","$http",function(a,b){a.form=new AngForm(["old_password","new_password"]),a.form.submit=function(a){var c=this.errors,d=this.success,e=this.loader;c.clear(),d.clear(),e.show(),b.defaults.headers.post["X-CSRFToken"]=Cookie.getCookie("csrftoken"),b.post(a,$.param(this.fields)).success(function(a){a.success===!0?d.set(a):c.show(a)}).error(function(){c.show()}).finally(function(){e.hide()})}}]),angular.module("UserApp").controller("SignCtrl",["$scope","UserHandler","UserPopup",function(a,b,c){a.login=c.showLogin,a.logout=b.logout}]),angular.module("UserApp").factory("UserPopup",function(){return function(){var a={LOGIN:0,REGISTER:1,FORGOT:2,CHANGE:3},b=a.LOGIN,c=$("#user-popup-modal"),d=function(a){return a===b},e=function(a){g()||c.modal(),b=a},f=function(){c.modal("hide")},g=function(){return c.is(":visible")};return{states:a,is_active:d,showLogin:function(){e(a.LOGIN)},showRegister:function(){e(a.REGISTER)},showForgot:function(){e(a.FORGOT)},showChange:function(){e(a.CHANGE)},hide:f}}()}),angular.module("UserApp").factory("UserHandler",["$http","$q","UserPopup",function(a,b,c){var d,e=function(){var c=b.defer();return a.get(window.check_user_auth_url).success(function(a){c.resolve(a.auth===!0?!0:!1)}).error(function(){c.reject("--error--")}),c.promise},f=function(a){var b=a.redirect;"function"==typeof d?(c.hide(),d(),d=void 0):b?location.replace(b):location.reload()},g=function(a){a&&(d=a),c.showLogin()},h=function(a){location.replace(a)};return{login:g,logout:h,is_auth:e,callback:f}}]);